{% extends "base.html" %}

{% block content %}
<section class="section">
    <div class="container">
        <div class="columns">
            <div class="column">
                {% include 'messages.html' %}
                <div class="columns">
                    <div class="column">
                        <h1 class="title">Ingredientes críticos cercanos</h1>
                        {% if ingrediente %}
                        <table class="table is-striped is-hoverable">
                            <thead>
                              <tr>
                                <th>Nombre</th>
                                <th>Stock</th>
                                <th>Alerta de stock</th>
                                <th>Fecha modificación</th>
                                <th>Editar</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for ingrediente in ingredientes_cerca_alerta  %}
                                  <tr>
                                    <td>{{ ingrediente.nombre }}</td>
                                    <td>{{ ingrediente.cantidad }} {{ ingrediente.unidadmedida.nombre }}</td>
                                    <td>{{ ingrediente.alerta_stock }} {{ ingrediente.unidadmedida.nombre }}</td>
                                    <td>{{ arrow.get(ingrediente.ultima_modificacion).to('America/Santiago').format('DD-MM-YYYY HH:mm') if ingrediente.ultima_modificacion != ingrediente.fecha_creacion else 'Nunca modificado' }}</td>
                                    <td>
                                      <a href="{{ url_for('ingrediente.editar', id=ingrediente.id) }}" class="button is-warning is-small">
                                        <span class="icon is-small"><i class="fa fa-pencil-alt" aria-hidden="true"></i></i></span>
                                      </a>
                                    </td>
                                  </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                        {% else %}
                          <p>No se encontraron ingrediente críticos cercanos.</p>
                        {% endif %}
                        <br>
                        <h1 class="title">Productos críticos cercanos</h1>
                        {% if producto %}
                        <table class="table is-striped is-hoverable">
                            <thead>
                              <tr>
                                <th>Nombre</th>
                                <th>Stock</th>
                                <th>Alerta de stock</th>
                                <th>Fecha modificación</th>
                                <th>Editar</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for producto in productos_cerca_alerta  %}
                                  <tr>
                                    <td>{{ producto.nombre }}</td>
                                    <td>{{ producto.stock }}</td>
                                    <td>{{ producto.alerta_stock }}</td>
                                    <td>{{ arrow.get(producto.ultima_modificacion).to('America/Santiago').format('DD-MM-YYYY HH:mm') if producto.ultima_modificacion != producto.fecha_creacion else 'Nunca modificado' }}</td>
                                    <td>
                                      <a href="{{ url_for('producto.editar', id=producto.id) }}" class="button is-warning is-small">
                                        <span class="icon is-small"><i class="fa fa-pencil-alt" aria-hidden="true"></i></i></span>
                                      </a>
                                    </td>
                                  </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                        {% else %}
                          <p>No se encontraron producto críticos cercanos.</p>
                        {% endif %}
                    </div>
                    <div class="column">
                        <h2 class="subtitle">Resumen del Inventario</h2>
                        <div class="card">
                            <div class="card-content">
                                <div class="content">
                                    <p><strong>Total de Ingredientes:</strong> {{ total_ingredientes }}</p>
                                    <p><strong>Ingredientes Críticos:</strong> {{ ingrediente_alerta_stock }}</p>
                                    {% if ingredientes_criticos %}
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Nombre</th>
                                                <th>Stock</th>
                                                <th>Última modificación</th>
                                                <th>Ingresar stock</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for ingrediente in ingredientes_criticos %}
                                            <tr>
                                                <td>{{ ingrediente.nombre }}</td>
                                                <td>El stock es de {{ ingrediente.cantidad }} {{ ingrediente.unidadmedida.nombre }}, lo cual es inferior al valor de alerta de stock establecido en {{ ingrediente.alerta_stock }} {{ ingrediente.unidadmedida.nombre }}</td>
                                                <td>{{ ingrediente.ultima_modificacion }}</td>
                                                <td>
                                                    <a href="{{ url_for('ingrediente.ingresar_stock', id=ingrediente.id) }}" class="button is-warning is-small">
                                                        <span class="icon is-small"><i class="fas fa-plus"></i><i class="fas fa-pepper-hot"></i></span>
                                                    </a>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                {% else %}
                                    <p>No hay ingredientes críticos.</p>
                                {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-content">
                                <div class="content">
                                    <p><strong>Total de productos:</strong> {{ total_productos }}</p>
                                    <p><strong>Productos Críticos:</strong> {{ producto_alerta_stock }}</p>
                                    {% if productos_criticos %}
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Nombre</th>
                                                <th>Stock</th>
                                                <th>Última modificación</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for productos_criticos in productos_criticos %}
                                            <tr>
                                                <td>{{ productos_criticos.nombre }}</td>
                                                {% if productos_criticos.tiene_receta == True %}
                                                    <td>El stock es de {{ productos_criticos.stock_disponible }} unidad(es) preparable(s), lo cual es inferior al valor de alerta de stock establecido en {{ productos_criticos.alerta_stock }} unidad(es)</td>
                                                {% else %}
                                                    <td>El stock es de {{ productos_criticos.stock_disponible }} unidad(es), lo cual es inferior al valor de alerta de stock establecido en {{ productos_criticos.alerta_stock }} unidad(es)</td>
                                                {% endif %}
                                                <td>{{ productos_criticos.ultima_modificacion }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                {% else %}
                                    <p>No hay productos críticos.</p>
                                {% endif %}
                                </div>
                            </div>
                        </div>
                        <!--
                        <h2 class="subtitle">Indicadores de Inventario</h2>
                        <div class="columns">
                            <div class="column">
                                <div class="card">
                                    <div class="card-content">
                                        <div class="content">
                                            <p><strong>Top 5 Ingredientes más Utilizados:</strong></p>
                                            <ol>
                                                <li>Tomates</li>
                                                <li>Lechuga</li>
                                                <li>Cebollas</li>
                                                <li>Pimientos</li>
                                                <li>Queso</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="column">
                                <div class="card">
                                    <div class="card-content">
                                        <div class="content">
                                            <p><strong>Top 5 productos más vendidos:</strong></p>
                                            <ol>
                                                <li>Lorem</li>
                                                <li>Ipsum</li>
                                                <li>Napolitana</li>
                                                <li>Peperonni</li>
                                                <li>Vegetariana</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
